defaults
    mode tcp

    timeout connect 3s
    timeout client 3s
    timeout server 3s

listen stats
    bind :7892 ssl crt /etc/haproxy/cert/zhijie.online.cert

    http-request redirect scheme https if !{ ssl_fc }

    mode http

    stats auth admin:admin
    stats enable
    stats refresh 1s
    stats uri /

resolvers v2ray_dns
    parse-resolv-conf

    resolve_retries 3

    hold nx 5m
    hold obsolete 5m
    hold other 5m
    hold refused 5m
    hold timeout 5m
    hold valid 5m

    timeout resolve 5m
    timeout retry 3s

frontend v2ray_in
    bind *:7891 tfo

    default_backend v2ray_out

    tcp-request inspect-delay 3s
    tcp-request content accept if { req_ssl_hello_type 1 }

backend v2ray_out
    balance leastconn

    option tcp-check

