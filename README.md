# ZJDNS Server

ğŸš€ é«˜æ€§èƒ½é€’å½’DNSè§£ææœåŠ¡å™¨ï¼ŒåŸºäºGoè¯­è¨€å¼€å‘ï¼Œæ”¯æŒRedisç¼“å­˜ã€DNSSECéªŒè¯ã€ECSç­‰é«˜çº§åŠŸèƒ½ã€‚

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

### ğŸ”§ æ ¸å¿ƒåŠŸèƒ½
- **é€’å½’DNSè§£æ**ï¼šå®Œæ•´å®ç°DNSé€’å½’æŸ¥è¯¢ç®—æ³•
- **åŒåè®®æ”¯æŒ**ï¼šåŒæ—¶æ”¯æŒUDPå’ŒTCPåè®®
- **CNAMEé“¾è§£æ**ï¼šæ™ºèƒ½å¤„ç†CNAMEè®°å½•é“¾ï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨
- **å¹¶å‘æŸ¥è¯¢**ï¼šé«˜æ€§èƒ½å¹¶å‘å¤„ç†ï¼Œæ”¯æŒè¿æ¥æ± ç®¡ç†
- **å¤šä¸Šæ¸¸ç­–ç•¥**ï¼šæ”¯æŒ`first_valid`ã€`prefer_trusted`ã€`round_robin`å’Œ`weighted`å››ç§ä¸Šæ¸¸æœåŠ¡å™¨é€‰æ‹©ç­–ç•¥
- **DNSé‡å†™åŠŸèƒ½**ï¼šæ”¯æŒç²¾ç¡®åŒ¹é…ã€å‰ç¼€ã€åç¼€å’Œæ­£åˆ™è¡¨è¾¾å¼é‡å†™è§„åˆ™

### ğŸ’¾ ç¼“å­˜ç³»ç»Ÿ
- **åŒæ¨¡å¼è¿è¡Œ**ï¼š
  - æ— ç¼“å­˜æ¨¡å¼ï¼šé€‚åˆæµ‹è¯•ç¯å¢ƒï¼Œé›¶é…ç½®å¯åŠ¨
  - Redisç¼“å­˜æ¨¡å¼ï¼šç”Ÿäº§ç¯å¢ƒæ¨èï¼Œæ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²
- **æ™ºèƒ½TTLç®¡ç†**ï¼šçµæ´»çš„TTLç­–ç•¥ï¼Œæ”¯æŒæœ€å°/æœ€å¤§TTLé™åˆ¶
- **è¿‡æœŸç¼“å­˜æœåŠ¡**ï¼šServe StaleåŠŸèƒ½ï¼Œæé«˜å¯ç”¨æ€§
- **é¢„å–æœºåˆ¶**ï¼šåå°è‡ªåŠ¨åˆ·æ–°å³å°†è¿‡æœŸçš„ç¼“å­˜
- **ECSæ„ŸçŸ¥ç¼“å­˜**ï¼šåŸºäºå®¢æˆ·ç«¯åœ°ç†ä½ç½®çš„ç¼“å­˜åˆ†åŒº

### ğŸ”’ å®‰å…¨ç‰¹æ€§
- **DNSSECéªŒè¯**ï¼šå®Œæ•´çš„DNSSECæ”¯æŒå’ŒéªŒè¯ï¼Œå¯è®¾ç½®æœåŠ¡å™¨å¼ºåˆ¶éªŒè¯
- **ECSæ”¯æŒ**ï¼šEDNS Client Subnetï¼Œæä¾›åœ°ç†ä½ç½®æ„ŸçŸ¥çš„è§£æ
- **é€’å½’æ·±åº¦ä¿æŠ¤**ï¼šé˜²æ­¢æ¶æ„é€’å½’æŸ¥è¯¢æ”»å‡»
- **IPè¿‡æ»¤**ï¼šåŸºäºCIDRçš„IPè¿‡æ»¤åŠŸèƒ½ï¼Œå¯åŒºåˆ†ä¸­å›½IPå’Œéä¸­å›½IP
- **ä¸Šæ¸¸ä¿¡ä»»ç­–ç•¥**ï¼šæ”¯æŒ`all`ã€`cn_only`å’Œ`non_cn_only`ä¸‰ç§ä¿¡ä»»ç­–ç•¥

### ğŸ“Š ç›‘æ§ç»Ÿè®¡
- **å®æ—¶ç»Ÿè®¡**ï¼šæŸ¥è¯¢é‡ã€ç¼“å­˜å‘½ä¸­ç‡ã€é”™è¯¯ç‡ç­‰
- **æ€§èƒ½æŒ‡æ ‡**ï¼šå¹³å‡å“åº”æ—¶é—´ã€QPSç»Ÿè®¡
- **å½©è‰²æ—¥å¿—**ï¼šæ”¯æŒemojiå’Œé¢œè‰²çš„ç»“æ„åŒ–æ—¥å¿—è¾“å‡º
- **åå°ä»»åŠ¡ç®¡ç†**ï¼šå¯é…ç½®çš„åå°ä»»åŠ¡å¤„ç†å™¨ï¼Œç”¨äºç¼“å­˜åˆ·æ–°ç­‰

### âš™ï¸ æ€§èƒ½ä¼˜åŒ–
- **åŠ¨æ€è¿æ¥æ± **ï¼šæ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´è¿æ¥æ•°é‡
- **å¯¹è±¡æ± ç®¡ç†**ï¼šå‡å°‘GCå‹åŠ›ï¼Œæé«˜å†…å­˜ä½¿ç”¨æ•ˆç‡
- **å¹¶å‘æ§åˆ¶**ï¼šå¯é…ç½®çš„æœ€å¤§å¹¶å‘æŸ¥è¯¢æ•°
- **ç¼“å­˜æ›´æ–°èŠ‚æµ**ï¼šå‡å°‘Rediså†™å…¥å‹åŠ›
- **é«˜æ•ˆç¼“å­˜é”®ç”Ÿæˆ**ï¼šä¼˜åŒ–çš„ç¼“å­˜é”®æ„å»ºå™¨

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DNS Client    â”‚â”€â”€â”€â–¶â”‚   ZJDNS Server   â”‚â”€â”€â”€â–¶â”‚  Upstream DNS   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                  â”‚    â”‚   (Root/Auth)   â”‚
                       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚  â”‚   Cache     â”‚  â”‚
                       â”‚  â”‚  (Redis)    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”€â”€â”€â–¶â”‚   DNSSEC Val    â”‚
                       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚  â”‚  IP Filter  â”‚  â”‚
                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                       â”‚  â”‚ DNS Rewriterâ”‚  â”‚
                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ é…ç½®é€‰é¡¹

### æ ¸å¿ƒé…ç½®
- **ç½‘ç»œè®¾ç½®**ï¼šç«¯å£ã€IPv6æ”¯æŒã€é»˜è®¤ECSå­ç½‘
- **TTLç­–ç•¥**ï¼šé»˜è®¤TTLã€æœ€å°/æœ€å¤§TTLã€è¿‡æœŸç¼“å­˜æœåŠ¡å‚æ•°
- **æ—¥å¿—çº§åˆ«**ï¼šæ”¯æŒNONEã€ERRORã€WARNã€INFOã€DEBUGäº”çº§æ—¥å¿—

### é«˜çº§åŠŸèƒ½
- **IPè¿‡æ»¤**ï¼šé€šè¿‡`china_cidr.txt`é…ç½®ä¸­å›½IPæ®µ
- **DNSé‡å†™**ï¼šæ”¯æŒå¤šç§é‡å†™è§„åˆ™ï¼Œå¯å®ç°åŸŸåé‡å®šå‘ã€è¿‡æ»¤ç­‰
- **ä¸Šæ¸¸æœåŠ¡å™¨**ï¼šå¯é…ç½®å¤šä¸ªä¸Šæ¸¸DNSæœåŠ¡å™¨ï¼Œè®¾ç½®ä¿¡ä»»ç­–ç•¥å’Œä¼˜å…ˆçº§
- **è¿æ¥æ± **ï¼šæ”¯æŒé™æ€å’ŒåŠ¨æ€è¿æ¥æ± ï¼Œä¼˜åŒ–ç½‘ç»œè¿æ¥

### æ€§èƒ½è°ƒä¼˜
- **å¹¶å‘æ§åˆ¶**ï¼šæœ€å¤§å¹¶å‘æŸ¥è¯¢æ•°
- **è¿æ¥æ± å¤§å°**ï¼šå¯é…ç½®æœ€å°/æœ€å¤§è¿æ¥æ•°
- **åå°ä»»åŠ¡**ï¼šå¯è°ƒæ•´åå°ä»»åŠ¡å¤„ç†workeræ•°é‡
- **ç¼“å­˜åˆ·æ–°**ï¼šå¯é…ç½®ç¼“å­˜é¢„å–å’Œåˆ·æ–°ç­–ç•¥

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### ç”Ÿæˆç¤ºä¾‹é…ç½®æ–‡ä»¶
```bash
./zjdns -generate-config > config.json
```

### å¯åŠ¨æœåŠ¡å™¨
```bash
# ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆçº¯é€’å½’æ¨¡å¼ï¼‰
./zjdns

# ä½¿ç”¨é…ç½®æ–‡ä»¶
./zjdns -config config.json
```

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- [miekg/dns](https://github.com/miekg/dns) - Go DNSåº“
- [go-redis/redis](https://github.com/go-redis/redis) - Redis Goå®¢æˆ·ç«¯
